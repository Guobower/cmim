<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>
		<!--****************************** cotisation ******************************** -->
		<record id="cotisation_search_view" model="ir.ui.view">
			<field name="name">cmim.cotisation.search</field>
			<field name="model">cmim.cotisation</field>
			<field name="arch" type="xml">
				<search string="Cotisation filtre">
					<field name="name" string="Nom" filter_domain="[('name','ilike',self)" />
					<field name="secteur_id" string="Secteur" filter_domain="[('secteur_id','=',self)" />
					<group expand="0" string="Group By">
						<filter name="collectivite_id" string="Collectivité"
							domain="[]" context="{'group_by':'collectivite_id'}" />
						<filter name="secteur_id" string="Secteur" domain="[]"
							context="{'group_by':'secteur_id'}" />
						<filter name="state" string="Etat" domain="[]"
							context="{'group_by':'state'}" />
					</group>
				</search>
			</field>
		</record>
		<record id="cotisation_tree_view" model="ir.ui.view">
			<field name="name">cmim.cotisation.tree</field>
			<field name="model">cmim.cotisation</field>
			<field name="mode">primary</field>
			<field name="priority" eval="1" />
			<field name="arch" type="xml">
				<tree>
					<field name="name" />
					<field name="collectivite_id" />
					<field name="secteur_id" />
					<field name="fiscal_date" />
					<field name="date_range_id" />
					<field name="montant" />
					<field name="state" />
				</tree>
			</field>
		</record>
		<record id="cotisation_form" model="ir.ui.view">
			<field name="name">cmim.cotisation.form</field>
			<field name="model">cmim.cotisation</field>
			<field name="arch" type="xml">
				<form string="Cotisation">
					<header>
						<button name="action_validate" type="object" string="Valider"
							attrs="{'invisible':[('state', '!=', 'draft')]}" class="oe_highlight"
							groups="base.group_user" />
						<field name="state" widget="statusbar" nolabel="1"
							statusbar_visible="draft,valide" />
					</header>
					<sheet string="Cotisation">
						<h1 class="mt0">
							<label string="Cotisation Brouillon" attrs="{'invisible': [('state','!=','draft')]}" />
							<field name="name" readonly="1" class="oe_inline"
								attrs="{'invisible': [('state','=','draft')]}" />
						</h1>
						<group>
							<group>
								<field string="Colectivité" name="collectivite_id"
									options='{"always_reload": True}' />

							</group>
							<group>
								<field name="fiscal_date" />
								<field name="date_range_id" />
							</group>
						</group>
						<notebook colspan="4">
							<page string="Récapitulatif" readonly='1'>
								<field name="cotisation_product_ids" nolabel="1"
									widget="one2many_list" mode="tree,kanban">
									<tree string="Cotisation Lines" editable="bottom">
										<field name="product_id" />
										<field name="code" />
										<field name="type_product_id" />
										<field name="montant" />
									</tree>
									<kanban class="o_kanban_mobile">
										<field name="product_id" />
										<field name="code" />
										<field name="type_product_id" />
										<field name="montant" />
										<templates>
											<t t-name="kanban-box">
												<div t-attf-class="oe_kanban_card oe_kanban_global_click">
													<div class="row">
														<div class="col-xs-12">
															<strong>
																<span>
																	<t t-esc="record.product_id.value or 'None'" />
																</span>
															</strong>
														</div>
													</div>
													<div class="row">
														<div class="col-xs-8 text-muted">
															<span>
																<t t-esc="record.code.value" />
																<t t-esc="record.type_product_id.value" />
															</span>
														</div>

														<div class="col-xs-4 text-muted">
															<span class="text-right">
																<t t-esc="record.montant.value" />
															</span>
														</div>
													</div>
												</div>
											</t>
										</templates>
									</kanban>
								</field>
								<group class="oe_subtotal_footer oe_right">
									<field name="montant" class="oe_subtotal_footer_separator" />
								</group>
							</page>
							<page string="Détails" readonly='1'>
								<field name="cotisation_assure_line_ids" nolabel="1"
									widget="one2many_list" mode="tree,kanban">
									<tree string="Cotisation assure Lines" editable="bottom">
										<field name="assure_id" />
										<field name="product_id" />
										<field name="code" />
										<field name="type_product_id" />
										<field name="base1" />
										<field name="rate1" />
										<field name="base2" />
										<field name="rate2" />
										<field name="montant" />
									</tree>
									<kanban class="o_kanban_mobile">
										<field name="assure_id" />
										<field name="product_id" />
										<field name="code" />
										<field name="type_product_id" />
										<field name="base1" />
										<field name="rate1" />
										<field name="base2" />
										<field name="rate2" />
										<field name="montant" />
										<templates>
											<t t-name="kanban-box">
												<div t-attf-class="oe_kanban_card oe_kanban_global_click">
													<div class="row">
														<div class="col-xs-12">
															<strong>
																<span>
																	<t t-esc="record.assure_id.value or 'None'" />
																	<t t-esc="record.product_id.value or 'None'" />
																</span>
															</strong>
														</div>
													</div>
													<div class="row">
														<div class="col-xs-8 text-muted">
															<span>
																<t t-esc="record.code.value" />
																<t t-esc="record.type_product_id.value" />
															</span>
														</div>
														<div class="col-xs-8 text-muted">
															<span>
																<t t-esc="record.base1.value" />
																<t t-esc="record.rate1.value" />
															</span>
														</div>
														<div class="col-xs-8 text-muted">
															<span>
																<t t-esc="record.base2.value" />
																<t t-esc="record.rate2.value" />
															</span>
														</div>
														<div class="col-xs-4 text-muted">
															<span class="text-right">
																<t t-esc="record.montant.value" />
															</span>
														</div>
													</div>
												</div>
											</t>
										</templates>
									</kanban>
								</field>
								<!-- <group class="oe_subtotal_footer oe_right"> -->
								<!-- <field name="montant" class="oe_subtotal_footer_separator" /> -->
								<!-- </group> -->
							</page>
						</notebook>
					</sheet>
				</form>
			</field>
		</record>

		<!-- ************************** Actions ******************************* -->
		<record id="action_cotisation" model="ir.actions.act_window">
			<field name="name">Cotisations</field>
			<field name="res_model">cmim.cotisation</field>
			<field name="view_id" ref="cotisation_tree_view" />
			<field name="search_id" ref="cotisation_search_view" />
			<field name="view_type">form</field>
			<field name="view_mode">tree,form,kanban</field>
		</record>


	</data>
</openerp>