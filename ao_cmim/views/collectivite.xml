<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>

		<!-- *****************************definition des adhesions ******************************* -->
		<record id="view_contrat_tree" model="ir.ui.view">
			<field name="name">cmim.contrat.tree</field>
			<field name="model">cmim.contrat</field>
			<field eval="7" name="priority" />
			
			<field name="arch" type="xml">
				<tree string="Assures">
					<field name="name" />
					<field name="assure_id" domain="[('id','!=',False)]" />
					<field name="collectivite_id" />
					<field name="product_id" />
					<field name="base_calcul" />
					<field name="tarif_id" />
					<field name="tarif_inc_deces_id" />
					<field name="tarif_inv_id" />
				</tree>
			</field>
		</record>
		<record id="view_contrat_form" model="ir.ui.view">
			<field name="name">cmim.contrat.form</field>
			<field name="model">cmim.contrat</field>
			<field name="priority" eval="1" />
			<field name="arch" type="xml">
				<form string="Assurés">
					<sheet>
						<group>
							<group>
								<field name="name" />
								<field name="for_assure" />
								<field name="assure_id" attrs="{'invisible': [('for_assure','=', False)]}" />
								<field name="collectivite_id" />
							</group>
							<group>
								<field name="product_id" />
								<field name="base_calcul" readonly='1' />
								<field name="tarif_id"
									attrs="{'invisible': [('base_calcul','!=', 'salaire')]}" />
								<field name="tarif_inc_deces_id"
									attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
								<field name="tarif_inv_id"
									attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
							</group>
						</group>
					</sheet>
				</form>
			</field>
		</record>
		<record id="contrat_search_view" model="ir.ui.view">
			<field name="name">cmim.contrat.search</field>
			<field name="model">cmim.contrat</field>
			<field name="arch" type="xml">
				<search string="Contrat filtre">
					<field name="collectivite_id" />
					<field name="assure_id" />
					<field name="product_id" />
					<group expand="0" string="Group By">
						<filter name="collectivite_id" string="Collectivité"
							domain="[]" context="{'group_by':'collectivite_id'}" />
						<filter name="assure_id" string="Assuré" domain="[]"
							context="{'group_by':'assure_id'}" />
						<filter name="product_id" string="Produit" domain="[]"
							context="{'group_by':'product_id'}" />
						<filter name="secteur_id" string="Secteur" domain="[]"
							context="{'group_by':'secteur_id'}" />
					</group>
					<filter name="import_flag" string="Contrats Exceptionnels par assurés"
						icon="terp-stock_symbol-selection" domain="[('for_assure', '=', 'True')]" />
				</search>
			</field>
		</record>
		<!-- *********************************** Assures ************************************** -->

		<record id="view_assure_tree" model="ir.ui.view">
			<field name="name">cmim.assure.tree</field>
			<field name="model">cmim.assure</field>
			<field eval="7" name="priority" />
			<field name="arch" type="xml">
				<tree string="Assures">
					<field name="numero" />
					<field name="id_num_famille" />
					<field name="name" />
					<field name="collectivite_id" />
					<field name="date_naissance" />
					<field name="email" />
					<field name="statut" />
				</tree>
			</field>
		</record>
		<record id="assure_search_view" model="ir.ui.view">
			<field name="name">cmim.assure.search</field>
			<field name="model">cmim.assure</field>
			<field name="arch" type="xml">
				<search string="Assure filtre">
					<field name="statut" />
					<field name="is_normal" />
					<group expand="0" string="Group By">
						<filter name="collectivite_id" string="Collectivité"
							domain="[]" context="{'group_by':'collectivite_id'}" />
						<!-- <filter name="id_num_famille" string="Assuré contractant" -->
						<!-- domain="[]" context="{'group_by':'id_num_famille'}" /> -->

						<filter name="statut" string="Statut" icon="terp-stock_symbol-selection"
							domain="[]" context="{'group_by':'statut'}" />
					</group>
					<filter name="is_normal" string="Assués normaux"
						icon="terp-stock_symbol-selection" domain="[('is_normal', '=', True)]" />
					<!-- <filter name="statut" string="Statut" -->
					<!-- icon="terp-stock_symbol-selection" domain-filter="[('statut', '=', 
						self)]" /> -->
					<filter name="is_normal" string="Assués exceptionnels"
						icon="terp-stock_symbol-selection" domain="[('is_normal', '=', False)]" />
				</search>
			</field>
		</record>
		<record id="view_assure_form" model="ir.ui.view">
			<field name="name">cmim.assure.form</field>
			<field name="model">cmim.assure</field>
			<field name="priority" eval="1" />
			<field name="arch" type="xml">
				<form string="Assurés">
					<sheet>
						<div class="oe_button_box" name="button_box">
							<!-- <button name="get_ayant_droits" type="object" string="Ayants 
								Droits" -->
							<!-- class="oe_inline oe_stat_button" icon="fa-users" /> -->
							<button name="get_declarations" type="object" string="Déclarations"
								class="oe_inline oe_stat_button" icon="fa-align-justify" />
						</div>
						<field name="image" widget='image' class="oe_avatar"
							options='{"preview_image": "image_medium", "size": [90, 90]}' />
						<div class="oe_title">
							<h1>
								<field name="name" default_focus="1" placeholder="Name" />
							</h1>
							<h2>
								<field name="numero" default_focus="1" placeholder="Numéro" />
							</h2>
						</div>
						<group>
							<group>
								<field name="statut" />
								<field name="collectivite_id" />
								<!-- <field name="parent_id" /> -->
								<field name="epoux_id" />
								<field name="id_num_famille" />
								<field name="date_naissance" />
								<field name="is_normal" string="Pas d'adhesion excéptionnelle" />

							</group>
							<group>

								<field name="phone" widget="phone" />
								<field name="mobile" widget="phone" />
								<label for="street" string="Address" />
								<div class="o_address_format">
									<field name="street" placeholder="Street..." class="o_address_street" />
									<field name="city" placeholder="City" class="o_address_city" />
									<field name="state_id" class="o_address_state"
										placeholder="State" />
									<field name="zip" placeholder="ZIP" class="o_address_zip" />
									<field name="country_id" placeholder="Country" class="o_address_country"
										options='{"no_open": True, "no_create": True}' />
								</div>
							</group>
						</group>

						<notebook colspan="4"
							attrs="{'invisible': [('is_normal','!=', False)]}">

							<page string="Contrats / Adhésions">
								<group>
									<field name="contrat_ids" nolabel="1">
										<form string="Contrats / adhesions">
											<group>
												<group>
													<field name="product_id" domain="[('type', '=', 'service')]" />
													<field name="name" />
												</group>
												<group>
													<field name="base_calcul" readonly='1' />
													<field name="tarif_id"
														attrs="{'invisible': [('base_calcul','!=', 'salaire')]}" />
													<field name="tarif_inc_deces_id"
														attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
													<field name="tarif_inv_id"
														attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
												</group>
											</group>
											<label for="name" />
											<field name="name" />
										</form>
										<tree string="Contrats / dhesions" editable="bottom">
											<field name="product_id" domain="[('type', '=', 'service')]" />
											<field name="name" />
											<field name="base_calcul" readonly='1' />
											<field name="tarif_id"
												attrs="{'invisible': [('base_calcul','!=', 'salaire')]}" />
											<field name="tarif_inc_deces_id"
												attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
											<field name="tarif_inv_id"
												attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
										</tree>
									</field>
								</group>
							</page>

						</notebook>
					</sheet>
				</form>
			</field>
		</record>


		<!-- *************************************** Collectivites ************************************** -->
		<record id="partner_search_view" model="ir.ui.view">
			<field name="name">ao.res.partner.search</field>
			<field name="model">res.partner</field>
			<field name="arch" type="xml">
				<search string="Collectivite filtre">
					<group expand="0" string="Group By">
						<filter name="secteur_id" string="Secteur" domain="[]"
							context="{'group_by':'secteur_id'}" />
					</group>
				</search>
			</field>
		</record>
		<record id="view_partner_tree" model="ir.ui.view">
			<field name="name">cmim.collectivite.tree</field>
			<field name="model">res.partner</field>
			<field eval="7" name="priority" />
			<field name="inherit_id" ref="base.view_partner_tree" />
			<field name="arch" type="xml">
				<field name="display_name" position="replace"></field>
				<field name="phone" position="before">
					<field name="code" string="Code Collectivité" />
					<field name="name" string="Raison sociale" />
					<field name="date_adhesion" string="date d'adhesion" />
					<field name="secteur_id" string="Secteur" />
				</field>
			</field>
		</record>
		<record id="view_collectivite_form" model="ir.ui.view">
			<field name="name">cmim.collectivite.form</field>
			<field name="model">res.partner</field>
			<field name="inherit_id" ref="base.view_partner_form" />
			<field name="arch" type="xml">
				<button name="toggle_active" position="after">

					<button name="get_assures" type="object" class="oe_inline oe_stat_button"
						icon="fa-users">
						<field string="Assurés" name="assures_count" widget="statinfo" />
					</button>
					<button name="get_declarations" type="object" string="Déclarations"
						class="oe_inline oe_stat_button" icon="fa-align-justify" />
					<button name="import_declaration" type="object"
						string="uploader déclarations" class="oe_inline oe_stat_button"
						icon="fa-level-up" />
					<button name="get_cotisations" type="object" string="Cotisations"
						class="oe_inline oe_stat_button" icon="fa-sign-out" />
					<button name="get_payments" type="object" string="Réglements"
						class="oe_inline oe_stat_button" icon="fa-sign-in" />
				</button>

				
				<xpath expr="//page[@name='sales_purchases']" position="before">
					<page string="Contrats / Adhésions">
						<group>
							<field name="contrat_ids" nolabel="1">
								<form string="Contrats / adhesions">
									<group>
										<group>
											<field name="product_id" domain="[('type', '=', 'service')]" />
											<field name="name" />
										</group>
										<group>
											<field name="base_calcul" readonly='1' />
											<field name="tarif_id"
												attrs="{'invisible': [('base_calcul','!=', 'salaire')]}" />
											<field name="tarif_inc_deces_id"
												attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
											<field name="tarif_inv_id"
												attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
										</group>
									</group>
									<label for="name" />
									<field name="name" />
								</form>
								<tree string="Contrats / dhesions" editable="bottom">
									<field name="product_id" domain="[('type', '=', 'service')]" />
									<field name="name" />
									<field name="base_calcul" readonly='1' />
									<field name="tarif_id"
										attrs="{'invisible': [('base_calcul','!=', 'salaire')]}" />
									<field name="tarif_inc_deces_id"
										attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
									<field name="tarif_inv_id"
										attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
								</tree>
							</field>
						</group>
					</page>
				</xpath>
				<page name='sales_purchases' position="attributes">
				<attribute name="invisible">True</attribute>
				</page>
				<field name="is_company" position="attributes">
					<attribute name="readonly">True</attribute>
				</field>
				<field name="company_type" position="attributes">
					<attribute name="readonly">True</attribute>
				</field>
				<field name="customer" position="attributes">
					<attribute name="readonly">True</attribute>
				</field>
				<field name="supplier" position="attributes">
					<attribute name="readonly">True</attribute>
				</field>
				<h1 position="replace">
					<h1>
						<field name="name" default_focus="1" placeholder="Raison Sociale"
							attrs="{'required' : [('type', '=', 'contact')]}" />
					</h1>
					<h2>
						<field name="code" placeholder="Code Collectivité"
							attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}" />
					</h2>
				</h1>
				<xpath expr="//label[@for='street']" position="before">
					<field name="secteur_id"
						attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}" />
					<field name="date_adhesion"
						attrs="{'readonly': [('type', '=', 'contact'),('parent_id', '!=', False)]}" />
				</xpath>
			</field>
		</record>

		<!-- ************************************ action *************************************** -->

		<record id="action_collectivite" model="ir.actions.act_window">
			<field name="name">Collectivités</field>
			<field name="res_model">res.partner</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form,kanban</field>
			<field name="domain" eval="[('customer','=',True),('is_company','=',True)]" />
			<field name="context">{"search_default_secteur_id":1}</field>
			<field name="view_id" ref="view_partner_tree" />
			<field name="search_id" ref="partner_search_view" />
		</record>
		<record id="action_assure" model="ir.actions.act_window">
			<field name="name">Assurés </field>
			<field name="res_model">cmim.assure</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form,kanban</field>
			<field name="domain" eval="[('parent_id','=',False)]" />
			<field name="context">{'group_by': ['statut','collectivite_id']}
			</field>
			<field name="view_id" ref="view_assure_tree" />
			<field name="search_id" ref="assure_search_view" />
		</record>
		<record id="action_beneficiaire" model="ir.actions.act_window">
			<field name="name">Bénéficiaires_ayant droit </field>
			<field name="res_model">cmim.assure</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form,kanban</field>
			<field name="context">{'group_by': ['secteur_id','collectivite_id']}
			</field>
			<field name="view_id" ref="view_assure_tree" />
			<field name="search_id" ref="assure_search_view" />
		</record>
		<record id="action_contrat" model="ir.actions.act_window">
			<field name="name">Contrats</field>
			<field name="res_model">cmim.contrat</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form,kanban</field>
			<field name="context">{'group_by': ['product_id','secteur_id']}</field>
			<field name="view_id" ref="view_contrat_tree" />
			<field name="search_id" ref="contrat_search_view" />
		</record>
	</data>
</openerp>
