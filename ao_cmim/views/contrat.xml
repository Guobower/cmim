<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>

		<!-- *****************************definition des adhesions ******************************* -->
		<record id="view_contrat_tree" model="ir.ui.view">
			<field name="name">cmim.contrat.tree</field>
			<field name="model">cmim.contrat</field>
			<field eval="7" name="priority" />

			<field name="arch" type="xml">
				<tree string="Assures">
					<field name="name" />
					<field name="assure_id" domain="[('id','!=',False)]" />
					<field name="collectivite_id" />
					<field name="product_id" />
					<field name="base_calcul" />
					<field name="tarif_id" />
					<field name="tarif_inc_deces_id" />
					<field name="tarif_inv_id" />
				</tree>
			</field>
		</record>
		<record id="view_contrat_form" model="ir.ui.view">
			<field name="name">cmim.contrat.form</field>
			<field name="model">cmim.contrat</field>
			<field name="priority" eval="1" />
			<field name="arch" type="xml">
				<form string="Assurés">
					<sheet>
						<group>
							<group>
								<field name="name" />
								<field name="for_assure" />
								<field name="assure_id" attrs="{'invisible': [('for_assure','=', False)]}" />
								<field name="collectivite_id" />
							</group>
							<group>
								<field name="product_id" />
								<field name="base_calcul" readonly='1' />
								<field name="tarif_id"
									attrs="{'invisible': [('base_calcul','!=', 'salaire')]}" />
								<field name="tarif_inc_deces_id"
									attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
								<field name="tarif_inv_id"
									attrs="{'invisible': [('base_calcul','!=', 'tranche')]}" />
							</group>
						</group>
					</sheet>
				</form>
			</field>
		</record>
		<record id="contrat_search_view" model="ir.ui.view">
			<field name="name">cmim.contrat.search</field>
			<field name="model">cmim.contrat</field>
			<field name="arch" type="xml">
				<search string="Contrat filtre">
					<field name="collectivite_id" />
					<field name="assure_id" />
					<field name="product_id" />
					<group expand="0" string="Group By">
						<filter name="collectivite_id" string="Collectivité"
							domain="[]" context="{'group_by':'collectivite_id'}" />
						<filter name="assure_id" string="Assuré" domain="[]"
							context="{'group_by':'assure_id'}" />
						<filter name="product_id" string="Produit" domain="[]"
							context="{'group_by':'product_id'}" />
						<filter name="secteur_id" string="Secteur" domain="[]"
							context="{'group_by':'secteur_id'}" />
					</group>
					<filter name="import_flag" string="Contrats Exceptionnels par assurés"
						icon="terp-stock_symbol-selection" domain="[('for_assure', '=', 'True')]" />
				</search>
			</field>
		</record>
		<record id="action_contrat" model="ir.actions.act_window">
			<field name="name">Contrats</field>
			<field name="res_model">cmim.contrat</field>
			<field name="view_type">form</field>
			<field name="view_mode">tree,form,kanban</field>
			<field name="context">{'group_by': ['product_id','secteur_id']}</field>
			<field name="view_id" ref="view_contrat_tree" />
			<field name="search_id" ref="contrat_search_view" />
		</record>
	</data>
</openerp>